# LuxModbus485

Прошивка для прибора измерения освещёности и управления диммером посредством Modbus.

Распиновка

Часы реального времени:
1.	SDA – бело-оранжевый,  A4;
2.	SCL – оранжевый,  A5;
3.	VCC – коричневый,  5V;
4.	GND – бело-коричневый,  GND.

Люксометр: 
1.	VCC – красный,  5V;
2.	SCL – коричневый,  A5;
3.	DAT – белый,  A4;
4.	GND – чёрный,  GND;
5.	ADDR – жёлтый,  GND.
	
Экран:
1.	5V – красный,  5v;
2.	GND – чёрный, GND;
3.	DIO – зелёный,  D3;
4.	CLK – белый, D2.

Энкодер:
1.	5V – красный, 5V;
2.	GND – чёрный, GND;
3.	KEY – D6;
4.	S1 – D5;
5.	S2 – D4.

RX485 модуль:
1.	DI – оранжевый,  TX;
2.	RO – бело-оранжевый, RX;
3.	DE и RE – замкнуты вместе, зелёный,  D7;
4.	VCC – коричневый,  5V;
5.	GND – бело-коричневый,  GND.
	
Плата с модулем DC-DC преобразователя:
1.	Синий провод – VIN;
2.	Бело-синий провод –  GND;
3.	Бело-зелёный провод – D8;
4.	Вход EN – выключение передачи(при подтяжке на минус);
5.	Вход плюс – 24V извне;
6.	Вход минус – 0V извне.

На плате распаяна колодка с тремя зажимами: +, -, EN.  Выходят с платы 3 провода: синий, бело-синий, бело-зелёный. Бело-зелёный провод соединён напрямую с EN.  DC-DC Настроить на 7 вольт.
Ошибки при включении прибора: 
1.	Err1 – ошибка чтения люксов;
2.	Err2 – ошибка  чтения памяти;
3.	Err3 – ошибка часов.

Режим работы точки:
1.	Горит постоянно – автоматический режим, вышел на уставку;
2.	Мигает часто (1 Hz) – автоматический режим, в процессе выхода на уставку;
3.	Мигает редко (0.25 Hz) – ошибка чтения из памяти,  для устранения сохранить “L”;
4.	Выключена – ручной режим или автоматический, но димирование отключено в ручную или по таймеру.

Главный экран:
1.	A(число) – автоматический режим, число указывает на текущие люксы;
2.	P(число) – ручной режим, число указывает на процент диммирования .
При переходе в меню, режим работы сохраняется.

Пункты меню:
1.	on – включен или выключен ,  1 или 0;
2.	L – уставка в люксах,  от 0 до 80;
3.	t – часы и минуты времени прибора;
4.	t1on – часы и минуты включения таймера 1;
5.	t1of – часы и минуты выключения таймера 1;
6.	t2on – часы и минуты включения таймера 2;
7.	t2of – часы и минуты выключения таймера 2;
8.	COL – калибровочный коэффициент люксов, от -25 до 25.
